bootstrap:docker
From:nvidia/cuda:11.1-cudnn8-runtime-ubuntu18.04

%setup
    echo "/.singularity.d/libs/" >> ${SINGULARITY_ROOTFS}/etc/ld.so.conf.d/singularity-nv.conf

%environment
    PATH=/opt/miniconda/bin:$PATH
	CUDA_HOME=/usr/local/cuda-11.1/

%post
    apt update
    apt install -y wget

    rm /etc/ld.so.cache
	ldconfig
    
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/condaInstall.sh
    bash ~/condaInstall.sh -b -p /opt/miniconda/

    export CMAKE_PREFIX_PATH=/opt/miniconda
	export CUDA_HOME=/usr/local/cuda-11.1/
	export PATH=/opt/miniconda/bin/:$PATH

    conda update -y -n base conda
    conda install -y python=3.7
    conda install -y -c anaconda caffe-gpu
    conda install -y numpy scipy pillow ipython protobuf numba